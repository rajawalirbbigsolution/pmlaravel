<?php
 namespace Symfony\Component\HttpKernel\DependencyInjection; use Psr\Container\ContainerInterface; use Symfony\Component\HttpFoundation\RequestStack; use Symfony\Component\HttpKernel\Fragment\FragmentHandler; class LazyLoadingFragmentHandler extends FragmentHandler { private $container; private $rendererIds = array(); private $initialized = array(); public function __construct(ContainerInterface $container, RequestStack $requestStack, $debug = false) { $this->container = $container; parent::__construct($requestStack, array(), $debug); } public function addRendererService($name, $renderer) { @trigger_error(sprintf('The %s() method is deprecated since Symfony 3.3 and will be removed in 4.0.', __METHOD__), E_USER_DEPRECATED); $this->rendererIds[$name] = $renderer; } public function render($uri, $renderer = 'inline', array $options = array()) { if (isset($this->rendererIds[$renderer])) { $this->addRenderer($this->container->get($this->rendererIds[$renderer])); unset($this->rendererIds[$renderer]); return parent::render($uri, $renderer, $options); } if (!isset($this->initialized[$renderer]) && $this->container->has($renderer)) { $this->addRenderer($this->container->get($renderer)); $this->initialized[$renderer] = true; } return parent::render($uri, $renderer, $options); } } 