<?php
 namespace Laravel\Socialite\Two; use Illuminate\Support\Arr; class GoogleProvider extends AbstractProvider implements ProviderInterface { protected $scopeSeparator = ' '; protected $scopes = [ 'openid', 'profile', 'email', ]; protected function getAuthUrl($state) { return $this->buildAuthUrlFromBase('https://accounts.google.com/o/oauth2/auth', $state); } protected function getTokenUrl() { return 'https://accounts.google.com/o/oauth2/token'; } protected function getTokenFields($code) { return array_add( parent::getTokenFields($code), 'grant_type', 'authorization_code' ); } protected function getUserByToken($token) { $response = $this->getHttpClient()->get('https://www.googleapis.com/plus/v1/people/me?', [ 'query' => [ 'prettyPrint' => 'false', ], 'headers' => [ 'Accept' => 'application/json', 'Authorization' => 'Bearer '.$token, ], ]); return json_decode($response->getBody(), true); } protected function mapUserToObject(array $user) { $avatarUrl = Arr::get($user, 'image.url'); return (new User)->setRaw($user)->map([ 'id' => $user['id'], 'nickname' => Arr::get($user, 'nickname'), 'name' => $user['displayName'], 'email' => Arr::get($user, 'emails.0.value'), 'avatar' => $avatarUrl, 'avatar_original' => preg_replace('/\?sz=([0-9]+)/', '', $avatarUrl), ]); } } 